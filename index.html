<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagicMirror Admin Panel</title>

    <!-- Tailwind CSS CDN Link -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Glassmorphism styles */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        /* Ensures the use of dark mode in supported systems */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #000000;
            }
            .container {
                background-color: rgba(0, 0, 0, 0.7); /* Transparent black with glass effect */
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-100">

    <!-- Main Container with Glassmorphism -->
    <div class="container max-w-2xl mx-auto p-8 glass">
        <h1 class="text-center text-3xl font-semibold mb-6 text-white">MagicMirror </h1>
        
        <!-- Input Field -->
        <div class="mb-4">
            <input id="textInput" type="text" placeholder="Enter text to show on the Mirror" class="w-full p-3 rounded-md border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        
        <!-- Update Button -->
        <button onclick="updateText()" class="w-full py-3 text-lg text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
            Add Text
        </button>

        <!-- Status Message -->
        <div id="status" class="text-center mt-4 text-lg text-white"></div>

        <!-- Display Current Texts -->
        <div id="displayTextContainer" class="mt-6 space-y-4">
            <!-- Dynamically populated text items with edit and delete options -->
        </div>
    </div>

    <!-- Firebase Script -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAITY47zm554EhZphnIYQO6GFQivenJ4qw",
            authDomain: "magic-mirror-d8667.firebaseapp.com",
            databaseURL: "https://magic-mirror-d8667-default-rtdb.firebaseio.com",
            projectId: "magic-mirror-d8667",
            storageBucket: "magic-mirror-d8667.firebasestorage.app",
            messagingSenderId: "1081967049681",
            appId: "1:1081967049681:web:d52512077edd7b7f153ef0"
        };

        // Initialize Firebase
        var app = firebase.initializeApp(firebaseConfig);
        var db = firebase.database(app);

        // Update text to Firebase
        function updateText() {
            const text = document.getElementById("textInput").value;
            const statusDiv = document.getElementById("status");

            if (text) {
                const newTextRef = db.ref('magicMirrorText').push();
                newTextRef.set({
                    text: text
                }).then(() => {
                    statusDiv.innerHTML = "Text updated successfully!";
                    statusDiv.style.color = "green";
                    displayCurrentText(); // To refresh the displayed texts
                }).catch((error) => {
                    statusDiv.innerHTML = "Error: " + error.message;
                    statusDiv.style.color = "red";
                });
            } else {
                statusDiv.innerHTML = "Please enter some text!";
                statusDiv.style.color = "red";
            }
        }

        // Fetch and Display Current Texts from Firebase
        function displayCurrentText() {
            const displayTextContainer = document.getElementById("displayTextContainer");
            displayTextContainer.innerHTML = '';  // Clear previous texts

            const textRef = db.ref('magicMirrorText');
            textRef.once('value', function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    const textData = childSnapshot.val();

                    const card = document.createElement('div');
                    card.className = 'card p-4 rounded-lg glass text-white shadow-xl';
                    card.innerHTML = `
                        <p class="text-lg mb-4">${textData.text}</p>
                        <div class="flex justify-end space-x-2">
                            <button onclick="editText('${childSnapshot.key}', '${textData.text}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md">
                                Edit
                            </button>
                            <button onclick="deleteText('${childSnapshot.key}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md">
                                Delete
                            </button>
                        </div>
                    `;
                    displayTextContainer.appendChild(card);
                });
            });
        }

        // Edit Text Function
        function editText(key, currentText) {
            const newText = prompt('Edit the text:', currentText);
            if (newText && newText !== currentText) {
                db.ref('magicMirrorText/' + key).update({
                    text: newText
                }).then(() => {
                    alert('Text updated!');
                    displayCurrentText();  // Refresh the list after editing
                });
            }
        }

        // Delete Text Function
        function deleteText(key) {
            if (confirm('Are you sure you want to delete this text?')) {
                db.ref('magicMirrorText/' + key).remove().then(() => {
                    displayCurrentText();  // Refresh the list after deletion
                });
            }
        }

        // Call to Display Current Texts on Initial Load
        displayCurrentText();
    </script>
</body>
</html>
